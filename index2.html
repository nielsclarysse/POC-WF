<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Wildlife Detection System</title>

    <!-- Bootstrap (mini) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        html, body { height: 100%; margin: 0; }
        #map { height: 400px; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-light">

<div class="container py-4" id="authScreen">
    <div class="text-center">
        <img src="https://via.placeholder.com/100" class="mb-3" alt="logo">
        <h3>Wildlife Detection System</h3>
        <p>Click authenticate to continue.</p>
        <button id="authBtn" class="btn btn-primary">Authenticate</button>
    </div>
</div>

<div class="container-fluid hidden" id="dashboard">
    <nav class="navbar navbar-expand bg-body-tertiary mb-3">
        <div class="container-fluid">
            <span class="navbar-brand">Wildlife Detection System</span>
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link active" href="#" data-tab="map">Camera Map</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-tab="data">Data</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-tab="subs">Subscription</a></li>
            </ul>
            <button class="btn btn-outline-danger btn-sm" id="logout">Logout</button>
        </div>
    </nav>

    <div id="mapView">
        <div class="row">
            <div class="col-md-3">
                <input id="search" class="form-control mb-2" placeholder="Search cameras">
                <ul class="list-group" id="cameraList"></ul>
            </div>
            <div class="col-md-9">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <div id="dataView" class="hidden">
        <div class="row">
            <div class="col-md-6">
                <canvas id="chartSightings"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="chartSpecies"></canvas>
            </div>
        </div>
    </div>

    <div id="subsView" class="hidden">
        <h4>Subscription Plans</h4>
        <div class="row">
            <div class="col-md-3"><button class="btn btn-outline-secondary w-100 buy" data-plan="Free">Free</button></div>
            <div class="col-md-3"><button class="btn btn-outline-primary w-100 buy" data-plan="Basic">Basic €4.99</button></div>
            <div class="col-md-3"><button class="btn btn-outline-success w-100 buy" data-plan="Research">Research €9.99</button></div>
            <div class="col-md-3"><button class="btn btn-outline-dark w-100 buy" data-plan="Custom">Custom</button></div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title" id="modalTitle">Confirm</h5></div>
            <div class="modal-body" id="modalBody">Confirm action?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const cameras = [
        {id:'cam1', name:'Trail Cam North', lat:51.21, lng:3.22},
        {id:'cam2', name:'Waterhole A', lat:51.215, lng:3.21},
        {id:'cam3', name:'Forest Edge', lat:51.205, lng:3.23}
    ];
    let map, markers={}, currentPlan=null;

    document.getElementById('authBtn').onclick=()=>{
        document.getElementById('authScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        initMap();
        renderCameraList();
    };

    document.getElementById('logout').onclick=()=>{
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('authScreen').classList.remove('hidden');
    };

    document.querySelectorAll('[data-tab]').forEach(btn=>{
        btn.onclick=()=>{
            document.querySelectorAll('[data-tab]').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('mapView').classList.add('hidden');
            document.getElementById('dataView').classList.add('hidden');
            document.getElementById('subsView').classList.add('hidden');
            document.getElementById(btn.dataset.tab+'View').classList.remove('hidden');
            if(btn.dataset.tab==='data') initCharts();
        };
    });

    function initMap(){
        map = L.map('map').setView([51.21,3.22],13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);
        cameras.forEach(c=>{
            const m=L.marker([c.lat,c.lng]).addTo(map).bindPopup(c.name);
            markers[c.id]=m;
        });
    }

    function renderCameraList(filter=''){
        const list=document.getElementById('cameraList');
        list.innerHTML='';
        cameras.filter(c=>c.name.toLowerCase().includes(filter.toLowerCase()))
            .forEach(c=>{
                const li=document.createElement('li');
                li.className='list-group-item list-group-item-action';
                li.textContent=c.name;
                li.onclick=()=>{
                    map.setView([c.lat,c.lng],14);
                    markers[c.id].openPopup();
                };
                list.appendChild(li);
            });
    }
    document.getElementById('search').oninput=(e)=>renderCameraList(e.target.value);

    function initCharts(){
        if(window._charts)return;
        new Chart(document.getElementById('chartSightings'),{
            type:'line',
            data:{labels:['Mon','Tue','Wed','Thu','Fri'],datasets:[{label:'Sightings',data:[5,9,6,8,10]}]}
        });
        new Chart(document.getElementById('chartSpecies'),{
            type:'doughnut',
            data:{labels:['Deer','Fox','Boar'],datasets:[{data:[40,30,30]}]}
        });
        window._charts=true;
    }

    const modalEl=document.getElementById('confirmModal');
    const modal=new bootstrap.Modal(modalEl);
    document.querySelectorAll('.buy').forEach(b=>{
        b.onclick=()=>{
            currentPlan=b.dataset.plan;
            document.getElementById('modalTitle').textContent='Confirm '+currentPlan;
            document.getElementById('modalBody').textContent='Buy '+currentPlan+' plan?';
            modal.show();
        };
    });
    document.getElementById('modalConfirm').onclick=()=>{
        alert(currentPlan==='Custom'?'Please contact us.':currentPlan+' plan confirmed.');
        modal.hide();
    };
</script>
</body>
</html>
